<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VSCode源码结构 | VSCode技术揭秘</title>
    <meta name="description" content="VSCode技术揭秘、VSCode源码解析、VSCode深度定制">
    <link rel="icon" href="/vscode-analysis/logo.ico">
    
    <link rel="preload" href="/vscode-analysis/assets/css/0.styles.b1f351a9.css" as="style"><link rel="preload" href="/vscode-analysis/assets/js/app.1346b767.js" as="script"><link rel="preload" href="/vscode-analysis/assets/js/2.90bbf243.js" as="script"><link rel="preload" href="/vscode-analysis/assets/js/8.d9813810.js" as="script"><link rel="prefetch" href="/vscode-analysis/assets/js/10.e16542e3.js"><link rel="prefetch" href="/vscode-analysis/assets/js/11.149737d3.js"><link rel="prefetch" href="/vscode-analysis/assets/js/12.1e867180.js"><link rel="prefetch" href="/vscode-analysis/assets/js/13.1513bbd8.js"><link rel="prefetch" href="/vscode-analysis/assets/js/14.00e12222.js"><link rel="prefetch" href="/vscode-analysis/assets/js/15.fd44da96.js"><link rel="prefetch" href="/vscode-analysis/assets/js/16.a6146f2f.js"><link rel="prefetch" href="/vscode-analysis/assets/js/3.6998bd47.js"><link rel="prefetch" href="/vscode-analysis/assets/js/4.3da122f8.js"><link rel="prefetch" href="/vscode-analysis/assets/js/5.a93be29b.js"><link rel="prefetch" href="/vscode-analysis/assets/js/6.d69b3162.js"><link rel="prefetch" href="/vscode-analysis/assets/js/7.71b53d4f.js"><link rel="prefetch" href="/vscode-analysis/assets/js/9.72419bfb.js">
    <link rel="stylesheet" href="/vscode-analysis/assets/css/0.styles.b1f351a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vscode-analysis/" class="home-link router-link-active"><!----> <span class="site-name">VSCode技术揭秘</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vscode-analysis/source/" class="nav-link router-link-active">正文</a></div><div class="nav-item"><a href="/vscode-analysis/learn/" class="nav-link">学习资料</a></div><div class="nav-item"><a href="https://github.com/codeteenager/vscode-analysis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vscode-analysis/source/" class="nav-link router-link-active">正文</a></div><div class="nav-item"><a href="/vscode-analysis/learn/" class="nav-link">学习资料</a></div><div class="nav-item"><a href="https://github.com/codeteenager/vscode-analysis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vscode-analysis/source/" class="sidebar-link">介绍</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>准备工作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vscode-analysis/source/tech-prep.html" class="sidebar-link">技术介绍</a></li><li><a href="/vscode-analysis/source/vscode-architecture.html" class="sidebar-link">VSCode架构</a></li><li><a href="/vscode-analysis/source/vscode-environment.html" class="sidebar-link">VSCode源码运行</a></li><li><a href="/vscode-analysis/source/vscode-source-structure.html" class="active sidebar-link">VSCode源码结构</a></li><li><a href="/vscode-analysis/source/vscode-start.html" class="sidebar-link">VSCode启动流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>应用定制</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vscode-analysis/source/app-meta.html" class="sidebar-link">应用信息定制</a></li><li><a href="/vscode-analysis/source/app-icon.html" class="sidebar-link">应用图标定制</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vscode源码结构"><a href="#vscode源码结构" class="header-anchor">#</a> VSCode源码结构</h1> <p>整体文件目录结构如下所示:</p> <p><img src="/vscode-analysis/assets/img/vscode-dir.0aa64091.png" alt="vscode-dir"></p> <div class="language-java extra-class"><pre class="language-java"><code>├── build         # gulp编译构建脚本
├── extensions    # 内置插件
├── gulpfile<span class="token punctuation">.</span>js   # gulp task
├── out           # 编译输出目录
├── resources     # 平台相关静态资源，图标等
├── scripts       # 工具脚本，开发<span class="token operator">/</span>测试
├── src           # 源码目录
├── test          # 测试套件
└── product<span class="token punctuation">.</span>json  # <span class="token class-name">App</span> meta信息
</code></pre></div><p>src下文件目录结构，如下图:</p> <p><img src="/vscode-analysis/assets/img/src-dir.7c925b22.png" alt="src-dir"></p> <div class="language-java extra-class"><pre class="language-java"><code>├── bootstrap<span class="token operator">-</span>amd<span class="token punctuation">.</span>js    # 子进程实际入口
├── bootstrap<span class="token operator">-</span>fork<span class="token punctuation">.</span>js   #
├── bootstrap<span class="token operator">-</span>window<span class="token punctuation">.</span>js #
├── bootstrap<span class="token punctuation">.</span>js        # 子进程环境初始化
├── buildfile<span class="token punctuation">.</span>js        # 构建config
├── cli<span class="token punctuation">.</span>js              # CLI入口
├── main<span class="token punctuation">.</span>js             # 主进程入口
├── paths<span class="token punctuation">.</span>js            # <span class="token class-name">AppDataPath</span>与<span class="token class-name">DefaultUserDataPath</span>
├── typings
│   └── xxx<span class="token punctuation">.</span>d<span class="token punctuation">.</span>ts        # ts类型声明
└── vs
    ├── base            # 定义基础的工具方法和基础的 DOM UI 控件
    │   ├── browser     # 基础UI组件，DOM操作、交互事件、<span class="token class-name">DnD</span>等
    │   ├── common      # diff描述，markdown解析器，worker协议，各种工具函数
    │   ├── node        # <span class="token class-name">Node</span>工具函数
    │   ├── parts       # IPC协议（<span class="token class-name">Electron</span>、<span class="token class-name">Node</span>），quickopen、tree组件
    │   ├── test        # base单测用例
    │   └── worker      # <span class="token class-name">Worker</span> factory 和 main <span class="token class-name">Worker</span>（运行IDE <span class="token class-name">Core</span>：<span class="token class-name">Monaco</span>）
    ├── code            # <span class="token class-name">VSCode</span> <span class="token class-name">Electron</span> 应用的入口，包括 <span class="token class-name">Electron</span> 的主进程脚本入口
    │   ├── electron<span class="token operator">-</span>browser # 需要 <span class="token class-name">Electron</span> 渲染器处理API的源代码（可以使用 common<span class="token punctuation">,</span> browser<span class="token punctuation">,</span> node）
    │   ├── electron<span class="token operator">-</span>main    # 需要<span class="token class-name">Electron</span>主进程API的源代码（可以使用 common<span class="token punctuation">,</span> node）
    │   ├── node        # 需要<span class="token class-name">Electron</span>主进程API的源代码（可以使用 common<span class="token punctuation">,</span> node）
    │   ├── test
    │   └── code<span class="token punctuation">.</span>main<span class="token punctuation">.</span>ts
    ├── editor          # <span class="token class-name">Monaco</span> <span class="token class-name">Editor</span> 代码编辑器：其中包含单独打包发布的 <span class="token class-name">Monaco</span> <span class="token class-name">Editor</span> 和只能在 <span class="token class-name">VSCode</span> 的使用的部分
    │   ├── browser     # 代码编辑器核心
    │   ├── common      # 代码编辑器核心
    │   ├── contrib     # vscode 与独立 IDE共享的代码
    │   ├── standalone  # 独立 IDE 独有的代码
    │   ├── test
    │   ├── editor<span class="token punctuation">.</span>all<span class="token punctuation">.</span>ts
    │   ├── editor<span class="token punctuation">.</span>api<span class="token punctuation">.</span>ts
    │   ├── editor<span class="token punctuation">.</span>main<span class="token punctuation">.</span>ts
    │   └── editor<span class="token punctuation">.</span>worker<span class="token punctuation">.</span>ts
    ├── platform        # 依赖注入的实现和 <span class="token class-name">VSCode</span> 使用的基础服务 <span class="token class-name">Services</span>
    ├── workbench       # <span class="token class-name">VSCode</span> 桌面应用程序工作台的实现
    ├── buildunit<span class="token punctuation">.</span>json
    ├── css<span class="token punctuation">.</span>build<span class="token punctuation">.</span>js    # 用于插件构建的CSS loader
    ├── css<span class="token punctuation">.</span>js          # CSS loader
    ├── loader<span class="token punctuation">.</span>js       # AMD loader（用于异步加载AMD模块，类似于require<span class="token punctuation">.</span>js）
    ├── nls<span class="token punctuation">.</span>build<span class="token punctuation">.</span>js    # 用于插件构建的 NLS loader
    └── nls<span class="token punctuation">.</span>js          # NLS（<span class="token class-name">National</span> <span class="token class-name">Language</span> <span class="token class-name">Support</span>）多语言loader
</code></pre></div><p>首先 VSCode 整体由其核心core和内置的扩展Extensions组成，core是实现了基本的代码编辑器和 VSCode 桌面应用程序，即 VSCode workbench，同时提供扩展 API，允许内置的扩展和第三方开发的扩展程序来扩展 VSCode Core 的能力。</p> <p>其次，由于 VSCode 依赖 Electron，而 Electron 存在着主进程和渲染进程，它们能使用的 API 有所不到，所以 VSCode Core 中每个目录的组织也按照它们能使用的 API 来组织安排。在 Core 下的每个子目录下，按照代码所运行的目标环境分为以下几类：</p> <ul><li>common: 只使用 JavaScript API 的源代码，可能运行在任何环境</li> <li>browser: 需要使用浏览器提供的 API 的源代码，如 DOM 操作等</li> <li>node: 需要使用Node.js提供的 API 的源代码</li> <li>electron-browser: 需要使用 Electron 渲染进程 API 的源代码</li> <li>electron-main: 需要使用 Electron 主进程 API 的源代码</li></ul> <p>按照上述规则，即src/vs/workbench/browser中的源代码只能使用基本的 JavaScript API 和浏览器提供的 API，而src/vs/workbench/electron-browser中的源代码则可以使用 JavaScript API，浏览器提供的 API、Node.js提供的 API、和 Electron 渲染进程中的 API。</p> <p>在 VSCode 代码仓库中，出了上述的src/vs的Core之外，还有一大块即 VSCode 内置的扩展，它们源代码位于extensions内。</p> <p>VSCode 作为代码编辑器，与各种代码编辑的功能如语法高亮、补全提示、验证等都有扩展实现的。所以在 VSCode 的内置扩展内，一大部分都是各种编程语言的支持扩展，如：extensions\html、extensions\javascript、extensions\cpp等等，大部分语言扩展中都会出现如.tmTheme、.tmLanguage等 TextMate 的语法定义。还有一类内置的扩展是 VSCode 主体扩展，如 VSCode 默认主体extensions/theme-defaults等。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vscode-analysis/source/vscode-environment.html" class="prev">VSCode源码运行</a></span> <span class="next"><a href="/vscode-analysis/source/vscode-start.html">VSCode启动流程</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/vscode-analysis/assets/js/app.1346b767.js" defer></script><script src="/vscode-analysis/assets/js/2.90bbf243.js" defer></script><script src="/vscode-analysis/assets/js/8.d9813810.js" defer></script>
  </body>
</html>
