<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VSCode架构 | VSCode技术揭秘</title>
    <meta name="description" content="VSCode技术揭秘、VSCode源码解析、VSCode深度定制">
    <link rel="icon" href="/vscode-analysis/logo.ico">
    
    <link rel="preload" href="/vscode-analysis/assets/css/0.styles.b1f351a9.css" as="style"><link rel="preload" href="/vscode-analysis/assets/js/app.1346b767.js" as="script"><link rel="preload" href="/vscode-analysis/assets/js/2.90bbf243.js" as="script"><link rel="preload" href="/vscode-analysis/assets/js/7.71b53d4f.js" as="script"><link rel="prefetch" href="/vscode-analysis/assets/js/10.e16542e3.js"><link rel="prefetch" href="/vscode-analysis/assets/js/11.149737d3.js"><link rel="prefetch" href="/vscode-analysis/assets/js/12.1e867180.js"><link rel="prefetch" href="/vscode-analysis/assets/js/13.1513bbd8.js"><link rel="prefetch" href="/vscode-analysis/assets/js/14.00e12222.js"><link rel="prefetch" href="/vscode-analysis/assets/js/15.fd44da96.js"><link rel="prefetch" href="/vscode-analysis/assets/js/16.a6146f2f.js"><link rel="prefetch" href="/vscode-analysis/assets/js/3.6998bd47.js"><link rel="prefetch" href="/vscode-analysis/assets/js/4.3da122f8.js"><link rel="prefetch" href="/vscode-analysis/assets/js/5.a93be29b.js"><link rel="prefetch" href="/vscode-analysis/assets/js/6.d69b3162.js"><link rel="prefetch" href="/vscode-analysis/assets/js/8.d9813810.js"><link rel="prefetch" href="/vscode-analysis/assets/js/9.72419bfb.js">
    <link rel="stylesheet" href="/vscode-analysis/assets/css/0.styles.b1f351a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vscode-analysis/" class="home-link router-link-active"><!----> <span class="site-name">VSCode技术揭秘</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vscode-analysis/source/" class="nav-link router-link-active">正文</a></div><div class="nav-item"><a href="/vscode-analysis/learn/" class="nav-link">学习资料</a></div><div class="nav-item"><a href="https://github.com/codeteenager/vscode-analysis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vscode-analysis/source/" class="nav-link router-link-active">正文</a></div><div class="nav-item"><a href="/vscode-analysis/learn/" class="nav-link">学习资料</a></div><div class="nav-item"><a href="https://github.com/codeteenager/vscode-analysis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vscode-analysis/source/" class="sidebar-link">介绍</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>准备工作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vscode-analysis/source/tech-prep.html" class="sidebar-link">技术介绍</a></li><li><a href="/vscode-analysis/source/vscode-architecture.html" class="active sidebar-link">VSCode架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vscode-analysis/source/vscode-architecture.html#vscode的进程结构" class="sidebar-link">VSCode的进程结构</a></li></ul></li><li><a href="/vscode-analysis/source/vscode-environment.html" class="sidebar-link">VSCode源码运行</a></li><li><a href="/vscode-analysis/source/vscode-source-structure.html" class="sidebar-link">VSCode源码结构</a></li><li><a href="/vscode-analysis/source/vscode-start.html" class="sidebar-link">VSCode启动流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>应用定制</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vscode-analysis/source/app-meta.html" class="sidebar-link">应用信息定制</a></li><li><a href="/vscode-analysis/source/app-icon.html" class="sidebar-link">应用图标定制</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vscode架构"><a href="#vscode架构" class="header-anchor">#</a> VSCode架构</h1> <p>VSCode中包含主进程，渲染进程，同时因为VSCode提供了插件的扩展能力，又出于安全稳定性的考虑，图中又多了一个Extension Host，其实这个Extension Host也是一个独立的进程，用于运行我们的插件代码。并且同渲染进程一样，彼此都是独立互不影响的。Extension Host Process暴露了一些VSCode的API供插件开发者去使用。
<img src="/vscode-analysis/assets/img/vscode-architecture.246227f5.jpeg" alt="vscode-architecture"></p> <h2 id="vscode的进程结构"><a href="#vscode的进程结构" class="header-anchor">#</a> VSCode的进程结构</h2> <p>VSCode采用多进程架构，启动后主要由下面几个进程：</p> <ul><li>后台进程</li> <li>编辑器窗口 - 由后台进程启动，也是多进程架构
<ul><li>HTML编写的UI
<ul><li>ActivityBar</li> <li>SideBar</li> <li>Panel</li> <li>Editor</li> <li>StatusBar</li></ul></li> <li>Nodejs异步IO
<ul><li>FileService</li> <li>ConfigurationService</li></ul></li> <li>插件宿主进程
<ul><li>插件实例
<ul><li>插件子进程 - 如TS语言服务</li></ul></li> <li>插件实例</li> <li>插件实例</li></ul></li> <li>Debug进程</li> <li>Search进程</li></ul></li></ul> <p><img src="/vscode-analysis/assets/img/vscode-process.e445e292.png" alt="vscode-process"></p> <h3 id="后台进程"><a href="#后台进程" class="header-anchor">#</a> 后台进程</h3> <p>后台进程是 VSCode 的入口，主要负责管理编辑器生命周期，进程间通信，自动更新，菜单管理等。</p> <p>我们启动 VSCode 的时候，后台进程会首先启动，读取各种配置信息和历史记录，然后将这些信息和主窗口 UI 的 HTML 主文件路径整合成一个 URL，启动一个浏览器窗口来显示编辑器的 UI。后台进程会一直关注 UI 进程的状态，当所有 UI 进程被关闭的时候，整个编辑器退出。</p> <p>此外后台进程还会开启一个本地的 Socket，当有新的 VSCode 进程启动的时候，会尝试连接这个 Socket，并将启动的参数信息传递给它，由已经存在的 VSCode 来执行相关的动作，这样能够保证 VSCode 的唯一性，避免出现多开文件夹带来的问题。</p> <h3 id="编辑器窗口"><a href="#编辑器窗口" class="header-anchor">#</a> 编辑器窗口</h3> <p>编辑器窗口进程负责整个 UI 的展示。也就是我们所见的部分。UI 全部用 HTML 编写没有太多需要介绍的部分。</p> <h3 id="nodejs异步io"><a href="#nodejs异步io" class="header-anchor">#</a> Nodejs异步IO</h3> <p>项目文件的读取和保存由主进程的 NodeJS API 完成，因为全部是异步操作，即便有比较大的文件，也不会对 UI 造成阻塞。IO 跟 UI 在一个进程，并采用异步操作，在保证 IO 性能的基础上也保证了 UI 的响应速度。</p> <h3 id="插件进程"><a href="#插件进程" class="header-anchor">#</a> 插件进程</h3> <p>每一个 UI 窗口会启动一个 NodeJS 子进程作为插件的宿主进程。所有的插件会共同运行在这个进程中。这样设计最主要的目的就是避免复杂的插件系统阻塞 UI 的响应。但是将插件放在一个单独进程也有很明显的缺点，因为是一个单独的进程，而不是 UI 进程，所以没有办法直接访问 DOM 树，想要实时高效的改变 UI 变得很难，在 VSCode 的扩展体系中几乎没有对 UI 进行扩展的 API。</p> <h3 id="debug进程"><a href="#debug进程" class="header-anchor">#</a> Debug进程</h3> <p>Debugger 插件跟普通的插件有一点区别，它不运行在插件进程中，而是在每次 debug 的时候由UI单独新开一个进程。</p> <h3 id="搜索进程"><a href="#搜索进程" class="header-anchor">#</a> 搜索进程</h3> <p>搜索是一个十分耗时的任务，VSCode 也使用的单独的进程来实现这个功能，保证主窗口的效率。将耗时的任务分到多个进程中，有效的保证了主进程的响应速度。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vscode-analysis/source/tech-prep.html" class="prev">技术介绍</a></span> <span class="next"><a href="/vscode-analysis/source/vscode-environment.html">VSCode源码运行</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/vscode-analysis/assets/js/app.1346b767.js" defer></script><script src="/vscode-analysis/assets/js/2.90bbf243.js" defer></script><script src="/vscode-analysis/assets/js/7.71b53d4f.js" defer></script>
  </body>
</html>
